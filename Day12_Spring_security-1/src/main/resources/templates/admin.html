<!DOCTYPE html>
<html>
<head>
<style>
body {
	position: relative;
	font-size: 20px;
}

th {
	width: 90px;
	border: 2px solid white;
	text-align: center;
}

table {
	position: relative;
	background-color: white;
}
.vertical{
display:none;
}

#div {
	margin: auto;
	background-color: white;
	height: 50%;
	max-width: 60%;
}

hr {
	background-color: black;
}

.borderClass{
	border : 1px solid black;
}

td {
	vertical-align: top;
	padding: 5px;
}

input[type="radio"] {
	vertical-align: bottom;
	width: 17px;
	height: 17px;
}

input[type="checkbox"] {
	vertical-align: bottom;
	width: 17px;
	height: 17px;
}

#Fname {
	
	font-size: 20px;
	/* background-color: #85d8ed; */
}

#fas{
	/* background:black; */	
	transform:rotate(90deg);
}
#alternate{
	background-color:black;
	padding:8px;
	display:inline;
	
}
#vert{
opacity:0.5;
 /* box-shadow: 10px 12px 0.5rem #85d8ed;
	background:white;
outline-offset: -30px; */
}
#content-mgmt{
		float:left;
		background-color:#bcf6f7;
		text-align:center;
		padding:15px;
}

.editor{
	text-align:right;
}
.ui-dialog-titlebar-close {
    visibility: hidden;
}

div.ui-dialog {position:fixed;}
</style>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<meta charset="UTF-8">
<title>Surveys</title>
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
</head>
<body>
	
	<strong><span id=Fname> <a href="/logout">logout</a></span></strong><br>
	<div id="content-mgmt"><h3 style="vertical-align:top; margin:0px;">Content Management</h3><br>
	<a href="/questionSavePage">Add questions</a><br><br>
	<a href="/graph">See graph</a>
	</div>	
  	<div id="edit-dialog"></div>
		<script type="text/javascript" src="../src/form2js.js"></script>
		<script type="text/javascript">
	var SendData;
		function test()
		{
			var content=[];
			var formData = form2js('testForm', '.', true,
					function(node)
					{
						if (node.id && node.id.match(/callbackTest/))
						{
							return { name: node.id, value: node.innerHTML };
						}
					});
			 SendData = JSON.stringify(formData);
			 //alert(SendData);
			 if(formData.question!= null)
				 {
				 	for(i=0;i<formData.question.length;i++)
				 		{
				 			//alert($("#question"+formData.question[i]).text());
				 			content.push({"key":"#question"+formData.question[i],"value":""+$("#question"+formData.question[i]).text()});
				 		}
				 
				 }
			 
			 if(formData.answer!= null)
			 {
			 	for(i=0;i<formData.answer.length;i++)
			 		{
			 			content.push({"key":"#answer"+formData.answer[i],"value":""+$("#answer"+formData.answer[i]).text()});
			 		}
			 
			 }
			 
			 if(formData.subquestion!= null)
			 {
			 	for(i=0;i<formData.subquestion.length;i++)
			 		{
			 			content.push({"key":"#sub"+formData.subquestion[i],"value":""+$("#subquestion"+formData.subquestion[i]).text()});
			 		}
			 
			 }
			 if(content.length >0 &&content.length<=4){
				 //alert(content);
				 edit(content,formData); 
			 }else
				 alert("Please Update no more than 4 field");
			 
			 function edit(content,formData){
				 
			 $("#edit-dialog").show();
			 
			 for(i=0;i<content.length;i++){
				 if(content[i].key.includes('question')){
					var dat = content[i].key.split("question")
					 $("#edit-dialog").append("<textarea cols=55 name=question."+dat[1]+" rows=4 id="+content[i].key+" style='resize:none'>"+content[i].value+"</textarea>"); 
				 }else if(content[i].key.includes('answer')){
						var dat = content[i].key.split("answer")
						 $("#edit-dialog").append("<textarea cols=55 name=answer."+dat[1]+" rows=4 id="+content[i].key+" style='resize:none'>"+content[i].value+"</textarea>"); 
					 } else if(content[i].key.includes('sub')){
							var dat = content[i].key.split("sub")
							 $("#edit-dialog").append("<textarea cols=55 name=subquestion."+dat[1]+" rows=4 id="+content[i].key+" style='resize:none'>"+content[i].value+"</textarea>"); 
						 }
				
			 }
				$("#edit-dialog").dialog({	
					
					width: 600,
					height: 'auto',
					draggable : false,					
					title : "Edit:",
					modal : true,
					resizable:false,
					buttons : [
						{
							text : "Update",
							click : function(){
								testing();
								/* for(i =0; i<$('textarea').length;i++){
									alert($('textarea').eq(i).attr('id'));
									
								} */
								location.reload();
								
								
							
							}
							
						},
						{
							text : "Cancel",
							click : function() {
								$("#edit-dialog").html("");
								$(this).dialog("close");
								
							}
							}
						
					]					
				});
			  }
			
			 
			// alert(SendData);
			 /* $.ajax({
					type : "POST",
					url : "/delete",
					data : SendData,
					//dataType : "json",
					contentType : 'application/json',					
					success:function(data){
							//alert(JSON.stringify(data));
							//location.reload();
							$("body").html(data);
					}
				});
 */		}
	
			
			
			
			/* $(document).on("click",function(){
				$.ajax({
					type : "POST",
					url : "/user",
					data : datas,
					dataType : "json",
					contentType : 'application/json'					
				});	 */
	
				function testing(){
					
					var formData = form2js('edit-dialog', '.', true,
							function(node)
							{
								if (node.id && node.id.match(/callbackTest/))
								{
									return { name: node.id, value: node.innerHTML };
								}
							});
					 SendData = JSON.stringify(formData);
					 alert(SendData);
				}
		
	</script>
	
		<!-- <div id="alternate">
		<button type="button" id="vert" autofocus><i style='font-size:24px' id='fas'  class='fas'>&#xf039;</i></button>
		<button type="button" id='horiz'><i style='font-size:24px'  class='fas'>&#xf039;</i></button>
	</div> -->
	
	<div id="div">
	<h1 align=center>Delete Questions and Answers</h1>
		<form id="testForm" action="javascript:test()" >

			<table class="table">


			</table>
			
		</form>
	</div>
	
	<script src='https://kit.fontawesome.com/a076d05399.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script type="text/javascript">
	 
	
		$(document)
				.ready(
						function() {
						 var align =0;
						 $("#edit-dialog").hide();
						
							//$(".vertical").show();
							//  $("#vert").click(function(){
							// 		$("#horiz").css({"opacity":"1"});
							// 		$(".horizontal").hide();
							// 		$(".vertical").show();
							// 		$(this).css({"opacity":"0.5"});
							// 		align =0;
							//  });
							//  $("#horiz").click(function(){
							// 		$("#vert").css({"opacity":"1"});
							// 		$(".vertical").hide();
							// 		$(".horizontal").show();
							// 		$(this).css({"opacity":"0.5"});
									
							//  });

							$.get("/getAuthenticatedFname", function(data) {
								//alert(data); 
								//master changes
								//branch changes
								//changes by master
								//agai
								$("#Fname").prepend("User: " + data);
							});
							
							
							$.get("/getAll",function(data) {
												//data = jQuery.parseJSON(data);
												// $( "div" ).append( JSON.stringfy(data));
												for (j = 0; j < data.length; j++) {
													var x = '<tr><td><td class="editor" ><button type = submit class="edit"><i class="fas fa-edit"></i></button><td><button name="" type=submit class="delete" ><i class="fas fa-trash"></i> </button></tr><tr class="border">	<td>'
														x+=	'&nbsp<td id="question'+data[j].qId+'">';
															
													x += data[j].qDescription
															+ '<td align=center><input class="check"  type="checkbox" name=question[] value="'+data[j].qId+'" ></tr>	';
													if (data[j].aType != "multiple") {
															
														
													
														for (i = 0; i < data[j].answer.length; i++) {
																
															x += '<tr ><td><td class="horizontal" id="answer'+data[j].answer[i].aId+'">'
																	+ data[j].answer[i].aDescription
																	+ '<td class="horizontal" align=center><input class="check" type="checkbox" name="answer[]" value="'+data[j].answer[i].aId+'"></tr>';
														}
														
														x += '	<tr><td colspan="3"><hr></tr>';
													} else {
														if(data[j].subQuestion.length != 0){
														x += '<tr><td></td><td><table   ><tr><td><td>';
														for(t=0 ;t<data[j].subQuestion[0].answer.length; t++){
															x+='<td align=center><input type="checkbox" name="answer[]" value="'+data[j].subQuestion[0].answer[t].aId+'">';
														}
														x+='</tr>';
														var ans;
														for (i = 0; i < data[j].subQuestion.length; i++) {
															if (i == 0) {
																x += '<tr><th colspan=2 style="background-color:#85d8ed; width:40%" >';
																//alert(data[j].subQuestion[i].answer[0].adescription);
																ans = data[j].subQuestion[i].answer.length;
																for (k = 0; k < ans; k++) {

																	x += '<th style="background-color:#85d8ed" id="answer'+data[j].subQuestion[i].answer[k].aId+'"> '
																			+ data[j].subQuestion[i].answer[k].aDescription
																			+ '</th>';
																}
																x += '</tr>';
															}
															//alert(data[j].subQuestion[i].answer[i].adescription);
															x += '<tr><td><input  type="checkbox" name="subquestion[]" value="'+data[j].subQuestion[i].id+'" class="subQues"><td id="subquestion'+data[j].subQuestion[i].id+'">'
																	+ data[j].subQuestion[i].qDescription
																	+ '</td></td>';
															for (k = 0; k < ans; k++) {

																x += '<td></td>';
															}
															//x += '</td>';
															x += '</tr>';

														}
														x += '</table></td></tr>';
													}
														x += '<tr><td colspan="3"><hr></tr>';
													
												}
													//x += '<tr><td><td align="right"><h3 align="left"><span style="vertical-align:top">Comments and suggestions: </span><textarea maxlength="255" name="commentC'+data[j].qId+'" cols="50" rows="3" style="border-top:none;border-right:none;border-left:none; " placeholder="Type your comments here"></textarea></h3></tr>';
													$(".table").append(x);
													//$("table").append(x);
													//alert( );

												}

											});
			
						});
		
		/* $(".table").on("click","#check",function(){
			//alert("clicked");
			$(this).parent().prev().css({
					
				'border' : '1px solid black'
			
			});
		 	
			
		
		});*/
		
		$(".table").on("click",".check",function(){
			$(this).parent().prev().toggleClass("borderClass");
		});
			
		$(".table").on("click",".subQues",function(){
			//$(this).parent().next().toggleClass("borderClass");
			alert($(this).parent().parent().index());
			//alert($(this).parent().parent().index()+1);
			
		});
		
		
	</script>
</body>
</html>
